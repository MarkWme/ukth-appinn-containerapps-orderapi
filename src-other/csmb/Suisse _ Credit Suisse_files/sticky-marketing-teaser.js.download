  
function adobeTargetIsVisible(el){
    return !!( el.offsetWidth || el.offsetHeight || el.getClientRects().length );
}

function adobeTargetExists(el){
	if(typeof(el) != 'undefined' && el != null){
        return true;
    }
	return false;
}

function adobeTargetGetHeight(el){
	return parseFloat(getComputedStyle(el, null).height.replace('px', ''));
}

function adobeTargetGetWidth(el){
	return parseFloat(getComputedStyle(el, null).width.replace('px', ''));
}

function adobeTargetGetOuterHeightWithMargin(el) {
	var height = el.offsetHeight;
	var style = getComputedStyle(el);
	height += parseInt(style.marginTop) + parseInt(style.marginBottom);
	return height;
}

function adobeTargetCheckOverlapSMT(smt_at_activity_id){
	
	// Reset counter for activities with lower priority
	
	if(adobeTargetExists(document.querySelector('.smt-container'))){
				
		var previous_smt_activty_id = document.querySelector('.smt-container').getAttribute('data-at-activity-id');
		
		console.log('AT - ' + smt_at_activity_id + ' - Teaser already present (' + previous_smt_activty_id + ')');
						
		var json_key = "profile."+previous_smt_activty_id+"Counter";
		var json_variable = {};
		var json_trackEvent = {
			'mbox': 'target-global-mbox',
			'params': {}
		};
		json_variable[json_key] = 0;
		json_trackEvent['params'] = json_variable;
		adobe.target.trackEvent(json_trackEvent);				
	}
	
	return true;
}

function adobeTargetOnClickCloseSMT(smt_at_activity_id, smt_closing_behaviour, smt_cookie_expiration){
	
	if(adobeTargetExists(document.querySelector('.smt-container[data-at-activity-id="'+smt_at_activity_id+'"] .smt-wrapper-close a'))){
	
		document.querySelector('.smt-container[data-at-activity-id="'+smt_at_activity_id+'"] .smt-wrapper-close a').onclick = function(e) {
			
			e.preventDefault();
			
			document.querySelector('.smt-container').style.display = 'none';

			if(smt_closing_behaviour == 'session-storage'){
				
				sessionStorage.setItem(smt_at_activity_id + 'DoNotShowTeaser', '1');
							
			} else if (smt_closing_behaviour == 'cookie'){
				
				var expires = (new Date(Date.now()+ 86400*1000*smt_cookie_expiration)).toUTCString();		
				window.document.cookie = smt_at_activity_id + "DoNotShowTeaser=1; expires=" + expires + "; path=/"; 
			}
		}
	}
	
	return true;
}

function adobeTargetShowSMT(smt_texts, smt_img_show, smt_img_src, smt_at_activity_id, smt_at_experience_id){
	
	var teaser_element = document.createElement('div');
	
	var teaser_html = 	'<div class="smt-container-absolute">' + 
							'<div class="smt-wrapper">';

	if(smt_img_show){		
		teaser_html += 			'<img class="smt-wrapper-img" src="' + smt_img_src + '" />';
	}
	
	teaser_html += 				'<div class="smt-wrapper-content">' + 
									'<h2 class="smt-wrapper-h2 h2">' + 
										smt_texts['h2'] + 
									'</h2>' +
									'<p class="smt-wrapper-p">' + 
										smt_texts['p'] + 
									'</p>' + 
									'<div class="smt-wrapper-cta link">' + 
										'<a class="a-primary-button" href="' + smt_texts['cta_url'] + '" data-aa-id="' + smt_at_activity_id + '-' + smt_at_experience_id + '-teaser-cta">' + 
											smt_texts['cta'] + 
											'<svg class="a-icon a-icon--small" viewBox="0 0 16 14">' + 
												'<path d="M9 0L7.6 1.4 12.2 6H0v2h12.2l-4.6 4.6L9 14l7-7z"></path>' + 
											'</svg>' + 
										'</a>' + 
									'</div>' + 
									'<div class="smt-wrapper-close">' + 
										'<a class="a-link" href="#" target="_blank" data-aa-id="' + smt_at_activity_id + '-' + smt_at_experience_id + '-teaser-close-cta">' + 
											'<svg class="a-icon" viewBox="0 0 357 357">' + 
												'<g id="close">' + 
													'<polygon points="357,35.7 321.3,0 178.5,142.8 35.7,0 0,35.7 142.8,178.5 0,321.3 35.7,357 178.5,214.2 321.3,357 357,321.3 214.2,178.5"/>' + 
												'</g>' + 
											'</svg>' + 
										'</a>' + 
									'</div>' + 
								'</div>' + 
							'</div>' +
						'</div>';
						
	teaser_element.innerHTML = teaser_html;
	teaser_element.classList.add('smt-container');
	teaser_element.setAttribute('data-at-activity-id', smt_at_activity_id);
						
	// If teaser already present, replace it
	
	if(adobeTargetExists(document.querySelector('.smt-container'))){
		
		clearTimeout(window.atTeaserTimeout);
		
		document.querySelector('.smt-container').parentNode.removeChild(document.querySelector('.smt-container'));		
		document.body.appendChild(teaser_element);			
					
	} else {
		
		document.body.appendChild(teaser_element);
	}
	
	if(window._adl.page.design == 'ux'){
								
		if(adobeTargetExists(document.querySelector('.m-masthead-nav'))){
									
			if(!adobeTargetIsVisible(document.querySelector('.m-masthead-nav__hamburger-menu-wrapper'))){
			
				console.log('AT - UX - MASTHEAD - DESKTOP');
									
				var smt_container_top = adobeTargetGetHeight(document.querySelector('.m-masthead-nav__main-wrapper')) + 10;
				
			} else {
				
				console.log('AT - UX - MASTHEAD - MOBILE');
				
				var smt_container_top = adobeTargetGetHeight(document.querySelector('.m-masthead-nav__main-wrapper'));					
			}	
						
		} else {
						
			if(adobeTargetGetWidth(document.querySelector('header')) >= 1149){
				
				console.log('AT - UX - OLD NAV - DESKTOP');
				
				var smt_container_top = adobeTargetGetHeight(document.querySelector('.o-nav .g-container--full')) + 10;
				
			} else {
				
				console.log('AT - UX - OLD NAV - MOBILE');
				
				var smt_container_top = adobeTargetGetHeight(document.querySelector('.o-nav .g-container--full')) + 10;								
			}		
		}
		
	} else {
		
		if(adobeTargetGetWidth(document.querySelector('header')) >= 1149){
			
			console.log('AT - Revamp - Desktop');

			var smt_container_top = document.querySelector('main').getBoundingClientRect().top - 35;
				
		} else {
			
			console.log('AT - Revamp - Mobile');
							
			var smt_container_top = adobeTargetGetHeight(document.querySelector('.layout_header')) + 10;
		}		
	}
	
	// Define position
	
	document.querySelector('.smt-container').style.top = smt_container_top + 'px';
	
	// Slide-in effect from the left
	
	document.querySelector('.smt-container').style.left = '-' + adobeTargetGetWidth(document.querySelector('.smt-wrapper')) + 'px';										
				
	var transform_x = parseInt(adobeTargetGetWidth(document.querySelector('.smt-wrapper')));
	
	window.atTeaserTimeout = setTimeout(function(){
		document.querySelector('.smt-container').style.opacity = '1';
		document.querySelector('.smt-container').style.transform = 'translateX(' + transform_x + 'px)';			
	}, 3000);	
	
	return true;	
}

function adobeTargetInsertSMT(smt_texts, smt_img_show, smt_img_src, smt_at_activity_id, smt_at_experience_id, smt_closing_behaviour){
		
	adobeTargetCheckOverlapSMT(smt_at_activity_id);
		
	if(smt_closing_behaviour == 'session-storage'){
						
		if(sessionStorage.getItem(smt_at_activity_id + 'DoNotShowTeaser') != '1'){		
			
			adobeTargetShowSMT(smt_texts, smt_img_show, smt_img_src, smt_at_activity_id, smt_at_experience_id);
				
		} else {
				
			console.log('AT - ' + smt_at_activity_id + ' - Teaser hidden');	
		}
		
	} else if (smt_closing_behaviour == 'cookie'){
		
		if(document.cookie.indexOf(smt_at_activity_id + 'DoNotShowTeaser') < 0){
			
			adobeTargetShowSMT(smt_texts, smt_img_show, smt_img_src, smt_at_activity_id, smt_at_experience_id);
			
		} else {
				
			console.log('AT - ' + smt_at_activity_id + ' - Teaser hidden');	
		}
	}
	
	return true;
}

function adobeTargetIncrementFCCounterSMT(smt_at_activity_id, smt_at_counter){
					
	console.log('AT - ' + smt_at_activity_id + ' - Counter: ' + smt_at_counter);						
	
	// Increment the counter only once per browser session
				
	if(sessionStorage.getItem(smt_at_activity_id + 'Init') != '1'){
		
		console.log('AT - ' + smt_at_activity_id + ' - Increasing counter: ' + (smt_at_counter + 1));	
		
		var json_key = "profile."+smt_at_activity_id+"Counter";
		var json_variable = {};
		var json_trackEvent = {
			'mbox': 'target-global-mbox',
			'params': {}
		};
		json_variable[json_key] = smt_at_counter + 1;
		json_trackEvent['params'] = json_variable;
		adobe.target.trackEvent(json_trackEvent);
		
		sessionStorage.setItem(smt_at_activity_id + 'Init', '1');				
	}

	return true;    
}
